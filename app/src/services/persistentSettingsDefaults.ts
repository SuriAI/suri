import type {
  AudioSettings,
  QuickSettings,
} from "../components/settings/types";
import type { UpdateInfo } from "../types/global";

export interface PersistentSettingsSchema {
  quickSettings: QuickSettings;

  audio: AudioSettings;

  attendance: {
    enableSpoofDetection: boolean;
    lateThresholdEnabled: boolean;
    lateThresholdMinutes: number;
    classStartTime: string;
    attendanceCooldownSeconds: number;
    reLogCooldownSeconds: number;
  };

  ui: {
    sidebarCollapsed: boolean;
    sidebarWidth: number;
    selectedGroupId: string | null;
    groupSidebarCollapsed: boolean;
    selectedCamera: string;
    selectedCameraLabel: string | null;
    lastRegistrationSource: string | null;
    lastRegistrationMode: string | null;
    hasSeenIntro: boolean;
    activeGroupSection: string | null;
    closeToTrayNoticeDismissed: boolean;
  };

  reportScratchpad: Record<
    string,
    {
      columns: string[];
      groupBy: string;
      statusFilter: string;
    }
  >;

  reportViews: Record<string, unknown>;
  reportDefaultViewNames: Record<string, string>;
  updater: {
    lastChecked: string | null;
    cachedInfo: UpdateInfo | null;
  };
  sync: {
    enabled: boolean;
    syncUrl: string;
    syncKey: string;
    intervalMinutes: number;
    lastSyncedAt: string | null;
  };
}

export const defaultSettings: PersistentSettingsSchema = {
  quickSettings: {
    showFPS: false,
    showRecognitionNames: true,
    cameraMirrored: true,
  },
  audio: {
    recognitionSoundEnabled: true,
    recognitionSoundUrl: "./assets/sounds/Recognition_Success.mp3",
  },
  attendance: {
    enableSpoofDetection: false,
    lateThresholdEnabled: false,
    lateThresholdMinutes: 5,
    classStartTime: "00:00",
    attendanceCooldownSeconds: 15,
    reLogCooldownSeconds: 1800, // 30 minutes default
  },
  ui: {
    sidebarCollapsed: false,
    sidebarWidth: 360, // Middle value between MIN_EXPANDED_WIDTH (240) and MAX_WIDTH (480)
    selectedGroupId: null,
    groupSidebarCollapsed: false,
    selectedCamera: "",
    selectedCameraLabel: null,
    lastRegistrationSource: null,
    lastRegistrationMode: null,
    hasSeenIntro: false,
    activeGroupSection: null,
    closeToTrayNoticeDismissed: false,
  },
  reportScratchpad: {},
  reportViews: {},
  reportDefaultViewNames: {},
  updater: {
    lastChecked: null,
    cachedInfo: null,
  },
  sync: {
    enabled: false,
    syncUrl: "",
    syncKey: "",
    intervalMinutes: 30, // Default to every 30 minutes
    lastSyncedAt: null,
  },
};
